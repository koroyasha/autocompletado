<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autocompletado N-gramas</title>
<style>
/* ===== RESET Y BASE ===== */
*{margin:0;padding:0;box-sizing:border-box;}
body{
    font-family: 'Arial', sans-serif;
    background:#0b1d3a;
    color:#fff;
    min-height:100vh;
    display:flex;
    flex-direction:column;
}

/* ===== CABECERA ===== */
header{
    background:#1e3a5f;
    padding:20px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom:4px solid #00bfff;
    position:sticky;
    top:0;
}
header h1{
    font-size:1.8rem;
    color:#00bfff;
}
header nav a{
    margin-left:20px;
    color:#95a5a6;
    text-decoration:none;
    font-weight:bold;
}
header nav a:hover{
    color:#00bfff;
}

/* ===== CONTENIDO PRINCIPAL ===== */
main{
    flex:1;
    padding:40px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-gap:40px;
}
@media(max-width:900px){
    main{grid-template-columns:1fr;}
}

/* Tarjeta */
.card{
    background:#11254d;
    border-radius:12px;
    padding:25px;
    box-shadow:0 4px 10px rgba(0,0,0,.5);
    border-left:6px solid #00bfff;
}
.card h2{
    color:#00bfff;
    margin-bottom:20px;
    font-size:1.4rem;
}

/* Formularios */
.form-group{
    margin-bottom:20px;
}
label{
    font-weight:bold;
    display:block;
    margin-bottom:6px;
    color:#00bfff;
}
input[type="text"],
input[type="number"],
select{
    width:100%;
    padding:12px;
    background:#1e3a5f;
    border:2px solid #0b1d3a;
    border-radius:6px;
    color:#fff;
    font-size:16px;
}
input:focus, select:focus{
    border-color:#00bfff;
    outline:none;
}
.checkbox-line{
    display:flex;
    align-items:center;
    margin-top:10px;
}
.checkbox-line input{margin-right:10px;}

button{
    width:100%;
    padding:12px;
    background:#00bfff;
    border:none;
    border-radius:6px;
    color:#fff;
    font-size:16px;
    cursor:pointer;
    transition:.3s;
}
button:hover{background:#0095dd;}

/* Sugerencias */
#resultados{
    margin-top:20px;
}
.sugerencia{
    background:#1e3a5f;
    margin:12px 0;
    padding:12px;
    border-radius:6px;
    position:relative;
}
.sugerencia strong{color:#00bfff;}
.sugerencia-principal{
    border-left:4px solid #27ae60;
    padding-left:10px;
    font-weight:bold;
}
.probabilidad{
    position:absolute;
    top:12px;
    right:12px;
    font-size:0.9em;
    color:#95a5a6;
}
.loading, .error{
    padding:15px;
    border-radius:6px;
    margin-top:10px;
    text-align:center;
}
.loading{color:#95a5a6;}
.error{background:#fadbd8;color:#e74c3c;}

/* Footer */
footer{
    background:#1e3a5f;
    text-align:center;
    padding:20px;
    font-size:0.9rem;
    color:#95a5a6;
}
</style>
</head>
<body>
<header>
    <h1>ü§ñ Autocompletado N-gramas</h1>
    <nav>
        <a href="{% url 'entrenar_modelo' %}">Entrenar Modelo</a>
        <a href="{% url 'lista_textos' %}">Lista de Textos</a>
    </nav>
</header>

<main>
    <!-- Columna 1 -->
    <section class="card">
        <h2>Configuraci√≥n</h2>
        <form id="autocompletadoForm">
            <div class="form-group">
                <label for="texto_id">Corpus</label>
                <select id="texto_id" required>
                    <option value="">-- Selecciona un texto --</option>
                    {% for texto in textos %}
                    <option value="{{ texto.id }}">{{ texto.titulo }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="n_grama">Orden del n-grama</label>
                <input type="number" id="n_grama" min="2" max="20" value="3">
            </div>

            <div class="form-group">
                <label for="max_sugerencias">M√°x. sugerencias</label>
                <input type="number" id="max_sugerencias" min="1" max="20" value="5">
            </div>

            <div class="checkbox-line">
                <input type="checkbox" id="fronteras">
                <label for="fronteras">Incluir fronteras &lt;s&gt; &lt;/s&gt;</label>
            </div>
        </form>
    </section>

    <!-- Columna 2 -->
    <section class="card">
        <h2>Texto de Entrada</h2>
        <div class="form-group">
            <label for="texto_input">Escribe tu texto</label>
            <input type="text" id="texto_input" placeholder="Ejemplo: 'el perro'..." required>
        </div>
        <button id="btn-sugerir">üöÄ Obtener sugerencias</button>

        <div id="resultados"></div>
    </section>
</main>

<footer>
    &copy; 2025 Autocompletado con N-gramas
</footer>

<script>
document.getElementById('btn-sugerir').addEventListener('click', function(){
    const texto   = document.getElementById('texto_input').value.trim();
    const textoId = document.getElementById('texto_id').value;
    const nGrama  = document.getElementById('n_grama').value;
    const maxSug  = document.getElementById('max_sugerencias').value;
    const fronteras = document.getElementById('fronteras').checked;

    if(!textoId){alert('Selecciona un corpus');return;}
    if(!texto){alert('Escribe alg√∫n texto');return;}

    const cont = document.getElementById('resultados');
    cont.innerHTML='<div class="loading">‚è≥ Calculando sugerencias...</div>';

    fetch('{% url "obtener_sugerencias" %}',{
        method:'POST',
        headers:{
            'Content-Type':'application/json',
            'X-CSRFToken':getCookie('csrftoken')
        },
        body:JSON.stringify({
            texto:texto,
            texto_id:textoId,
            n_grama:nGrama,
            max_sugerencias:maxSug,
            fronteras:fronteras
        })
    })
    .then(r=>r.ok?r.json():Promise.reject('Error de servidor'))
    .then(data=>{
        if(data.error){
            cont.innerHTML='<div class="error">‚ùå '+data.error+'</div>';return;
        }
        if(data.sugerencias.length===0){
            cont.innerHTML='<div class="sugerencia">Sin sugerencias.</div>';return;
        }
        let html=`<h3>Sugerencias para: "${data.contexto}"</h3>`;
        data.sugerencias.forEach((s,i)=>{
            const pct=(s.probabilidad*100).toFixed(2);
            html+=`
            <div class="sugerencia ${i===0?'sugerencia-principal':''}">
                <strong>${s.palabra}</strong>
                <span class="probabilidad">${pct}%</span>
                <br><small style="color:#95a5a6;">N-grama: ${s.ngrama_completo}</small>
            </div>`;
        });
        cont.innerHTML=html;
    })
    .catch(err=>cont.innerHTML='<div class="error">‚ùå '+err+'</div>');
});

function getCookie(name){
    let value=null;
    document.cookie.split(';').forEach(c=>{
        c=c.trim();
        if(c.startsWith(name+'=')) value=decodeURIComponent(c.split('=')[1]);
    });
    return value;
}
</script>
</body>
</html>
